# ç¬¬å…­éƒ¨åˆ†ï¼šæ•´åˆèˆ‡æ”¶å°¾

æœ¬éƒ¨åˆ†é è¨ˆæ™‚é–“ï¼š20 åˆ†é˜

## ä»»å‹™ 24ï¼šå®Œæ•´çš„åˆ†ææµç¨‹

ğŸ“‹ **è¤‡è£½é€™æ®µè©±ï¼Œè²¼çµ¦ AIï¼š**

> è«‹å¹«æˆ‘å¯«ä¸€å€‹å®Œæ•´çš„ R scriptï¼Œå¾é ­åˆ°å°¾åšå®Œä»¥ä¸‹åˆ†æï¼š
> 
> 1. è®€å– patient_data.csv
> 2. ç”¨ gtsummary ç”¢å‡º Table 1ï¼ˆä¾ç…§ treatment åˆ†çµ„ï¼Œå« p-valueï¼‰
> 3. ç”¨ ggplot2 ç•«ä¸€å€‹æ¯”è¼ƒå…©çµ„ los çš„ç›’ç‹€åœ–
> 4. åšçµ±è¨ˆæª¢å®šæ¯”è¼ƒå…©çµ„ los
> 5. æŠŠè¡¨æ ¼å­˜æˆ Word æª”ã€åœ–å­˜æˆ PNG æª”
> 
> è«‹æŠŠç¨‹å¼ç¢¼æ•´ç†æˆä¸€å€‹å¯ä»¥å¾é ­è·‘åˆ°å°¾çš„ scriptï¼Œä¸¦åŠ ä¸Šè¨»è§£èªªæ˜æ¯ä¸€æ­¥åœ¨åšä»€éº¼ã€‚

### å®Œæ•´åˆ†æè…³æœ¬

```{r}
#| label: complete-analysis
#| echo: true
#| message: false
#| warning: false
#| eval: false

# ===========================
# è‡¨åºŠç ”ç©¶çµ±è¨ˆåˆ†æå®Œæ•´è…³æœ¬
# ===========================

# è¼‰å…¥å¿…è¦å¥—ä»¶
library(gtsummary)
library(ggplot2)
library(dplyr)

# å®‰è£ä¸¦è¼‰å…¥ flextableï¼ˆå¦‚æœéœ€è¦ï¼‰
if (!require(flextable, quietly = TRUE)) {
  install.packages("flextable", repos = "https://cloud.r-project.org/")
  library(flextable)
}

# 1. è®€å–è³‡æ–™
# ---------------------------
my_data <- read.csv("patient_data.csv")
print("è³‡æ–™è®€å–æˆåŠŸï¼")
print(paste("å…±æœ‰", nrow(my_data), "ç­†è³‡æ–™"))

# 2. å»ºç«‹ Table 1
# ---------------------------
table1 <- my_data %>%
  select(treatment, age, gender, los) %>%
  tbl_summary(
    by = treatment,
    label = list(
      age ~ "å¹´é½¡ï¼ˆæ­²ï¼‰",
      gender ~ "æ€§åˆ¥",
      los ~ "ä½é™¢å¤©æ•¸ï¼ˆå¤©ï¼‰"
    ),
    statistic = list(
      all_continuous() ~ "{mean} Â± {sd}",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) %>%
  add_p() %>%
  bold_p(t = 0.05) %>%
  modify_header(label ~ "**è®Šé …**") %>%
  modify_spanning_header(c("stat_1", "stat_2") ~ "**æ²»ç™‚çµ„åˆ¥**")

# é¡¯ç¤º Table 1
print(table1)

# 3. ç¹ªè£½ç›’ç‹€åœ–
# ---------------------------
p <- ggplot(my_data, aes(x = treatment, y = los, fill = treatment)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5, size = 2) +
  scale_fill_manual(values = c("A" = "steelblue", "B" = "darkorange")) +
  labs(
    title = "å…©çµ„æ²»ç™‚çš„ä½é™¢å¤©æ•¸æ¯”è¼ƒ",
    x = "æ²»ç™‚çµ„åˆ¥",
    y = "ä½é™¢å¤©æ•¸ï¼ˆå¤©ï¼‰"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
  )

# é¡¯ç¤ºåœ–è¡¨
print(p)

# 4. çµ±è¨ˆæª¢å®š
# ---------------------------
# t-test
t_test <- t.test(los ~ treatment, data = my_data)
print("ç¨ç«‹æ¨£æœ¬ t æª¢å®šçµæœï¼š")
print(t_test)

# Wilcoxon testï¼ˆç„¡æ¯æ•¸æ›¿ä»£æ–¹æ³•ï¼‰
wilcox_test <- wilcox.test(los ~ treatment, data = my_data)
print("Wilcoxon rank-sum æª¢å®šçµæœï¼š")
print(wilcox_test)

# 5. å„²å­˜è¼¸å‡º
# ---------------------------
# å„²å­˜ Table 1 ç‚º Word æª”
table1 %>%
  as_flex_table() %>%
  save_as_docx(path = "Table1_output.docx")
print("Table 1 å·²å„²å­˜ç‚º Table1_output.docx")

# å„²å­˜ç›’ç‹€åœ–ç‚º PNG æª”
ggsave(
  filename = "boxplot_los_comparison.png",
  plot = p,
  width = 8,
  height = 6,
  dpi = 300,
  units = "in"
)
print("ç›’ç‹€åœ–å·²å„²å­˜ç‚º boxplot_los_comparison.png")

print("===== åˆ†æå®Œæˆï¼=====")
```

## ä»»å‹™ 25ï¼šåšæˆä½ çš„ç¯„æœ¬

ğŸ“‹ **è¤‡è£½é€™æ®µè©±ï¼Œè²¼çµ¦ AIï¼š**

> è«‹æŠŠå‰›å‰›çš„ script æ”¹æˆä¸€å€‹ã€Œç¯„æœ¬ã€ï¼ŒæŠŠæª”æ¡ˆåç¨±ã€åˆ†çµ„è®Šæ•¸ã€è¦åˆ†æçš„è®Šæ•¸éƒ½ç”¨æ¸…æ¥šçš„è®Šæ•¸åç¨±æ¨™ç¤ºåœ¨æœ€ä¸Šé¢ï¼Œé€™æ¨£æˆ‘ä»¥å¾Œåªè¦æ”¹æœ€ä¸Šé¢çš„è¨­å®šï¼Œå°±å¯ä»¥å¥—ç”¨åˆ°ä¸åŒçš„è³‡æ–™ã€‚

### å¯é‡è¤‡ä½¿ç”¨çš„åˆ†æç¯„æœ¬

```{r}
#| label: analysis-template
#| echo: true
#| message: false
#| warning: false
#| eval: false

# ========================================
# è‡¨åºŠç ”ç©¶çµ±è¨ˆåˆ†æç¯„æœ¬
# ä½¿ç”¨èªªæ˜ï¼šä¿®æ”¹ä¸‹æ–¹è¨­å®šå€çš„åƒæ•¸å³å¯
# ========================================

# ========== è¨­å®šå€ ==========
# è«‹æ ¹æ“šæ‚¨çš„è³‡æ–™ä¿®æ”¹ä»¥ä¸‹åƒæ•¸

# æª”æ¡ˆè¨­å®š
DATA_FILE <- "patient_data.csv"          # è³‡æ–™æª”æ¡ˆåç¨±
OUTPUT_TABLE <- "Table1_results.docx"    # è¼¸å‡ºè¡¨æ ¼æª”å
OUTPUT_FIGURE <- "comparison_plot.png"   # è¼¸å‡ºåœ–æª”å

# è®Šæ•¸è¨­å®š
GROUP_VAR <- "treatment"                 # åˆ†çµ„è®Šæ•¸
CONTINUOUS_VARS <- c("age", "los")       # é€£çºŒè®Šæ•¸
CATEGORICAL_VARS <- c("gender")          # é¡åˆ¥è®Šæ•¸
OUTCOME_VAR <- "los"                     # ä¸»è¦çµæœè®Šæ•¸ï¼ˆç”¨æ–¼ç•«åœ–ï¼‰

# æ¨™ç±¤è¨­å®šï¼ˆä¸­æ–‡åç¨±ï¼‰
LABELS <- list(
  age = "å¹´é½¡ï¼ˆæ­²ï¼‰",
  gender = "æ€§åˆ¥",
  los = "ä½é™¢å¤©æ•¸ï¼ˆå¤©ï¼‰",
  treatment = "æ²»ç™‚çµ„åˆ¥"
)

# åœ–è¡¨è¨­å®š
PLOT_TITLE <- "å…©çµ„æ²»ç™‚çš„ä½é™¢å¤©æ•¸æ¯”è¼ƒ"
GROUP_COLORS <- c("steelblue", "darkorange")  # å…©çµ„çš„é¡è‰²

# ========== åˆ†æç¨‹å¼ï¼ˆé€šå¸¸ä¸éœ€ä¿®æ”¹ï¼‰==========

# è¼‰å…¥å¥—ä»¶
required_packages <- c("gtsummary", "ggplot2", "dplyr", "flextable")

for (pkg in required_packages) {
  if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
    install.packages(pkg, repos = "https://cloud.r-project.org/")
    library(pkg, character.only = TRUE)
  }
}

# è®€å–è³‡æ–™
data <- read.csv(DATA_FILE)
print(paste("æˆåŠŸè®€å–", nrow(data), "ç­†è³‡æ–™"))

# å»ºç«‹è®Šæ•¸æ¸…å–®
all_vars <- c(GROUP_VAR, CONTINUOUS_VARS, CATEGORICAL_VARS)

# ç”¢ç”Ÿ Table 1
table_result <- data %>%
  select(all_of(all_vars)) %>%
  tbl_summary(
    by = all_of(GROUP_VAR),
    label = LABELS,
    statistic = list(
      all_continuous() ~ "{mean} Â± {sd}",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) %>%
  add_p() %>%
  bold_p(t = 0.05)

print(table_result)

# ç¹ªè£½æ¯”è¼ƒåœ–
plot_formula <- as.formula(paste(OUTCOME_VAR, "~", GROUP_VAR))

comparison_plot <- ggplot(data, 
                          aes_string(x = GROUP_VAR, 
                                    y = OUTCOME_VAR, 
                                    fill = GROUP_VAR)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5, size = 2) +
  scale_fill_manual(values = GROUP_COLORS) +
  labs(
    title = PLOT_TITLE,
    x = LABELS[[GROUP_VAR]],
    y = LABELS[[OUTCOME_VAR]]
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
  )

print(comparison_plot)

# çµ±è¨ˆæª¢å®š
test_result <- t.test(plot_formula, data = data)
print(test_result)

# å„²å­˜çµæœ
table_result %>%
  as_flex_table() %>%
  save_as_docx(path = OUTPUT_TABLE)

ggsave(
  filename = OUTPUT_FIGURE,
  plot = comparison_plot,
  width = 8,
  height = 6,
  dpi = 300
)

print(paste("åˆ†æå®Œæˆï¼çµæœå·²å„²å­˜è‡³", OUTPUT_TABLE, "å’Œ", OUTPUT_FIGURE))
```

## ä»»å‹™ 26ï¼šç•¶ä½ é›¢é–‹é€™å€‹æ•™å®¤ä¹‹å¾Œ

ğŸ“‹ **è¤‡è£½é€™æ®µè©±ï¼Œè²¼çµ¦ AIï¼š**

> æˆ‘æ˜¯ä¸€å€‹å‰›å­¸ R çš„é†«è­·äººå“¡ï¼Œä¸»è¦æƒ³ç”¨ R åšè‡¨åºŠç ”ç©¶çš„çµ±è¨ˆåˆ†æã€‚è«‹æ¨è–¦æˆ‘ï¼š
> 
> 1. 3 å€‹æœ€å€¼å¾—å­¸çš„ R æŠ€èƒ½ï¼ˆä»¥æˆ‘çš„éœ€æ±‚ä¾†èªªï¼‰
> 2. 2 å€‹é©åˆåˆå­¸è€…çš„å…è²»å­¸ç¿’è³‡æº
> 3. ç•¶æˆ‘é‡åˆ°å•é¡Œæ™‚ï¼Œé™¤äº†å•ä½ ä¹‹å¤–ï¼Œé‚„å¯ä»¥å»å“ªè£¡æ‰¾ç­”æ¡ˆ

### æŒçºŒå­¸ç¿’å»ºè­°

#### æœ€å€¼å¾—å­¸çš„ 3 å€‹ R æŠ€èƒ½

1. **è³‡æ–™æ•´ç†ï¼ˆdplyr å¥—ä»¶ï¼‰**
   - `filter()`ï¼šç¯©é¸è³‡æ–™
   - `select()`ï¼šé¸æ“‡æ¬„ä½
   - `mutate()`ï¼šæ–°å¢è¨ˆç®—æ¬„ä½
   - `group_by()` + `summarise()`ï¼šåˆ†çµ„çµ±è¨ˆ

2. **çµ±è¨ˆåˆ†æï¼ˆåŸºç¤ R + å°ˆé–€å¥—ä»¶ï¼‰**
   - åŸºç¤çµ±è¨ˆæª¢å®šï¼š`t.test()`, `wilcox.test()`, `chisq.test()`
   - è¿´æ­¸åˆ†æï¼š`lm()`, `glm()`
   - å­˜æ´»åˆ†æï¼š`survival` å¥—ä»¶

3. **è³‡æ–™è¦–è¦ºåŒ–ï¼ˆggplot2ï¼‰**
   - åŸºæœ¬åœ–å½¢ï¼šæ•£ä½ˆåœ–ã€é•·æ¢åœ–ã€ç›’ç‹€åœ–
   - å®¢è£½åŒ–ï¼šä¸»é¡Œã€é¡è‰²ã€æ¨™ç±¤
   - è«–æ–‡å“è³ªè¼¸å‡ºï¼šé«˜è§£æåº¦ã€é©ç•¶å°ºå¯¸

#### å…è²»å­¸ç¿’è³‡æº

1. **R for Data Science (ç·šä¸Šå…è²»æ›¸)**
   - ç¶²å€ï¼šhttps://r4ds.had.co.nz/
   - ä¸­æ–‡ç‰ˆä¹Ÿæœ‰å…è²»ç·šä¸Šç‰ˆæœ¬

2. **Swirl äº’å‹•å¼å­¸ç¿’å¥—ä»¶**
   ```r
   install.packages("swirl")
   library(swirl)
   swirl()
   ```

#### å•é¡Œè§£æ±ºè³‡æº

1. **Stack Overflow**
   - æœå°‹é—œéµå­—åŠ ä¸Š "R"
   - å¤§éƒ¨åˆ†å•é¡Œéƒ½æœ‰äººå•é

2. **R å®˜æ–¹æ–‡ä»¶**
   - åœ¨ R ä¸­è¼¸å…¥ `?å‡½æ•¸åç¨±` æŸ¥çœ‹èªªæ˜
   - ä¾‹å¦‚ï¼š`?t.test`

3. **çµ±è¨ˆè«®è©¢**
   - é†«é™¢æˆ–å­¸æ ¡çš„çµ±è¨ˆè«®è©¢ä¸­å¿ƒ
   - ç·šä¸Šçµ±è¨ˆè«–å£‡ï¼ˆå¦‚ Cross Validatedï¼‰

### ç·´ç¿’å»ºè­°

```{r}
#| label: practice-tips
#| echo: false
#| message: false
#| warning: false

library(tibble)
library(knitr)

practice_plan <- tibble(
  é€±æ¬¡ = 1:4,
  ç·´ç¿’é‡é» = c(
    "é‡è¤‡ä»Šå¤©çš„å…§å®¹ï¼Œç”¨è‡ªå·±çš„è³‡æ–™",
    "å­¸ç¿’ dplyr è³‡æ–™æ•´ç†",
    "å˜—è©¦ä¸åŒçš„çµ±è¨ˆæª¢å®š",
    "è£½ä½œæ›´è¤‡é›œçš„åœ–è¡¨"
  ),
  å»ºè­°æ™‚é–“ = c(
    "æ¯å¤© 30 åˆ†é˜",
    "æ¯å¤© 30 åˆ†é˜",
    "æ¯é€± 2-3 æ¬¡",
    "æ¯é€± 2-3 æ¬¡"
  )
)

kable(practice_plan, align = "c")
```

## ä»Šå¤©å­¸æœƒçš„è¶…èƒ½åŠ›ç¸½çµ

- âœ… æŠŠå•é¡Œæè¿°æ¸…æ¥šï¼Œè®“ AI å¹«ä½ å¯«ç¨‹å¼
- âœ… çœ‹æ‡‚ AI çµ¦çš„ç¨‹å¼ç¢¼å¤§æ¦‚åœ¨åšä»€éº¼
- âœ… ç•¶ç¨‹å¼å‡ºéŒ¯ï¼ŒçŸ¥é“æ€éº¼å• AI ä¿®æ­£
- âœ… ç”¢å‡ºå¯ä»¥æ”¾é€²è«–æ–‡çš„è¡¨æ ¼å’Œåœ–è¡¨
- âœ… æœ‰ä¸€å€‹å¯ä»¥é‡è¤‡ä½¿ç”¨çš„åˆ†æç¯„æœ¬

**ä½ ä¸éœ€è¦è¨˜ä½ä»»ä½•èªæ³•ï¼Œä½†è¦è¨˜ä½å¦‚ä½•å•å°å•é¡Œï¼**